Mysql性能优化
=============

数据库设计优化
--------------

1.  表设计

    -   避免冗余数据，多表共用用ID字段关联

    -   简化字段命名，如user表user_name字段可简化为name

    -   行压缩，行格式COMPRESSED

2.  列设计

    -   选择合适的数据类型

    -   避免设置默认null值

3.  索引设计

    -   强制创建主键索引

    -   复合(多列)索引，频繁作为条件的列顺序靠前

    -   为大字符串列索引指定前缀长度

    -   避免主键长度过长，主键会默认在所有二级索引中存储

SQL优化
-------

1.  匹配索引

    -   最左匹配原则

    -   字段类型相同、长度相同、字符集一致

    -   exists取代 in/not in

2.  函数调用

    -   避免在索引列上做函数调用/运算操作

事物管理优化
------------

1.  指定只读事物为READ_ONLY

2.  分解操作，多次commit

3.  避免回滚批量更新操作

4.  批量更新操作，关闭autocommit

缓存内存
--------

1.  缓冲池大小，--innodb-buffer-pool-size= 134217728（默认128M)

2.  table_open_cache = max_connections \* N + K

锁
--

1.  行锁

2.  间隙锁

3.  表锁

-   共享锁（读

-   排它锁（写


InnoDB 多版本并发控制（MVCC)
--
### 背景
为了支持数据库的事务特性，同时在并发场景下的性能保证，产生了mvcc的概念。

### 关键要素
- 回滚日志 undo log
- 数据行隐藏字段 （DB_TRX_ID、DB_ROLL_PTR、DB_ROW_ID)
- 快照 snapshot 

MySQL 部署方式
-- 

### 复制集群 (异步复制、半同步）
- 一主多从
- 两主互备
- 多层主从

### 组复制集群（poxis
- 单主集群
- 多主集群